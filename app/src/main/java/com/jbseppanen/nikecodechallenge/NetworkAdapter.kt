package com.jbseppanen.nikecodechallenge

import java.io.BufferedReader
import java.io.IOException
import java.io.InputStream
import java.io.InputStreamReader
import java.net.HttpURLConnection
import java.net.MalformedURLException
import java.net.URL

object NetworkAdapter {
    const val GET = "GET"
    const val POST = "POST"
    const val PUT = "PUT"
    const val DELETE = "DELETE"
    const val TIMEOUT = 3000


    interface NetworkCallback {
        fun returnResult(success: Boolean?, result: String)
    }

    fun httpRequest(stringUrl: String, requestType: String, jsonBody: String?, callback: NetworkCallback) {
        Thread(Runnable {
            var result = ""
            var success = false
            var stream: InputStream? = null
            var connection: HttpURLConnection? = null
            try {
                val url = URL(stringUrl)
                connection = url.openConnection() as HttpURLConnection
                connection.readTimeout = TIMEOUT
                connection.connectTimeout = TIMEOUT
                connection.requestMethod = requestType
                connection.setRequestProperty("Content-Type", "application/json")

                if (requestType == GET || requestType == DELETE) {
                    connection.connect()
                } else if (requestType == POST || requestType == PUT) {
                    if (jsonBody != null) {
                        val outputStream = connection.outputStream
                        outputStream.write(jsonBody.toByteArray())
                        outputStream.close()
                    }
                }

                if (connection.responseCode == HttpURLConnection.HTTP_OK) {
                    stream = connection.inputStream
                    if (stream != null) {
                        val reader = BufferedReader(InputStreamReader(stream))
                        val builder = StringBuilder()
                        var line: String? = reader.readLine()
                        while (line != null) {
                            builder.append(line)
                            line = reader.readLine()
                        }
                        result = builder.toString()
                        success = true
                    }
                }

            } catch (e: MalformedURLException) {
                e.printStackTrace()
                result = e.message.toString()
            } catch (e: IOException) {
                e.printStackTrace()
                result = e.message.toString()
            } finally {
                connection?.disconnect()

                if (stream != null) {
                    try {
                        stream.close()
                    } catch (e: IOException) {
                        e.printStackTrace()
                    }

                }
            }
            if (!success && result == "timeout") {
                result = default_data
                success = true
            }
            callback.returnResult(success, result)
        }).start()
    }

   val default_data = """{"feed":{"title":"Coming Soon","id":"https://rss.itunes.apple.com/api/v1/us/apple-music/coming-soon/all/100/explicit.json","author":{"name":"iTunes Store","uri":"http://wwww.apple.com/us/itunes/"},"links":[{"self":"https://rss.itunes.apple.com/api/v1/us/apple-music/coming-soon/all/100/explicit.json"},{"alternate":"https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewRoom?fcId=1396220241\u0026app=music"}],"copyright":"Copyright © 2018 Apple Inc. All rights reserved.","country":"us","icon":"http://itunes.apple.com/favicon.ico","updated":"2019-05-31T01:35:20.000-07:00","results":[{"artistName":"Jonas Brothers","id":"1461478261","releaseDate":"2019-06-07","name":"Happiness Begins","kind":"album","copyright":"℗ 2019 Jonas Brothers Recording, Limited Liability Company, under exclusive license to Republic Records, a division of UMG Recordings, Inc.","artistId":"114342891","artistUrl":"https://music.apple.com/us/artist/jonas-brothers/114342891?app=music","artworkUrl100":"https://is2-ssl.mzstatic.com/image/thumb/Music113/v4/fa/c2/d5/fac2d55b-d2ba-03ab-855b-fb9722419c88/19UMGIM38391.rgb.jpg/200x200bb.png","genres":[{"genreId":"14","name":"Pop","url":"https://itunes.apple.com/us/genre/id14"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/happiness-begins/1461478261?app=music"},{"artistName":"Mark Ronson","id":"1459276577","releaseDate":"2019-06-21","name":"Late Night Feelings","kind":"album","copyright":"℗ 2019 Sony Music Entertainment UK Limited","artistId":"1806833","contentAdvisoryRating":"Explicit","artistUrl":"https://music.apple.com/us/artist/mark-ronson/1806833?app=music","artworkUrl100":"https://is5-ssl.mzstatic.com/image/thumb/Music113/v4/04/f1/ae/04f1ae8e-aed1-3739-5510-8c2e4df10b3c/886447539873.jpg/200x200bb.png","genres":[{"genreId":"14","name":"Pop","url":"https://itunes.apple.com/us/genre/id14"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/late-night-feelings/1459276577?app=music"},{"artistName":"Vince Gill","id":"1464199399","releaseDate":"2019-08-23","name":"Okie","kind":"album","copyright":"An MCA Nashville Release; ℗ 2019 UMG Recordings, Inc.","artistId":"27175","artistUrl":"https://music.apple.com/us/artist/vince-gill/27175?app=music","artworkUrl100":"https://is1-ssl.mzstatic.com/image/thumb/Music123/v4/ac/4e/ef/ac4eefbe-5099-d010-c6b7-7c4821688d53/19UMGIM38065.rgb.jpg/200x200bb.png","genres":[{"genreId":"6","name":"Country","url":"https://itunes.apple.com/us/genre/id6"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/okie/1464199399?app=music"},{"artistName":"Runaway June","id":"1463372365","releaseDate":"2019-06-28","name":"Blue Roses","kind":"album","copyright":"℗ 2019 This Is Hit, Inc. d/b/a Wheelhouse Records","artistId":"1114217696","artistUrl":"https://music.apple.com/us/artist/runaway-june/1114217696?app=music","artworkUrl100":"https://is3-ssl.mzstatic.com/image/thumb/Music113/v4/df/49/ee/df49ee26-e09d-96c3-17c0-b13161f89b9b/4050538508727.jpg/200x200bb.png","genres":[{"genreId":"6","name":"Country","url":"https://itunes.apple.com/us/genre/id6"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/blue-roses/1463372365?app=music"},{"artistName":"Madonna","id":"1459938538","releaseDate":"2019-06-14","name":"Madame X (Deluxe)","kind":"album","copyright":"℗ 2019 Boy Toy, Inc., Exclusively licensed to Live Nation Worldwide, Inc. Exclusively licensed to Interscope Records","artistId":"20044","artistUrl":"https://music.apple.com/us/artist/madonna/20044?app=music","artworkUrl100":"https://is4-ssl.mzstatic.com/image/thumb/Music123/v4/a9/3e/b0/a93eb05e-ffee-be74-8674-9b9006afc555/00602577826078.rgb.jpg/200x200bb.png","genres":[{"genreId":"14","name":"Pop","url":"https://itunes.apple.com/us/genre/id14"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/madame-x-deluxe/1459938538?app=music"},{"artistName":"Ed Sheeran","id":"1464549183","releaseDate":"2019-07-12","name":"No.6 Collaborations Project","kind":"album","copyright":"2019 an Asylum Records UK release, a division of Atlantic Records UK; (P) 2019 Warner Music UK Limited, except track 6 ℗ 2019 Warner Music UK Limited / Def Jam Recordings, a division of UMG Recordings, Inc.","artistId":"183313439","contentAdvisoryRating":"Explicit","artistUrl":"https://music.apple.com/us/artist/ed-sheeran/183313439?app=music","artworkUrl100":"https://is1-ssl.mzstatic.com/image/thumb/Music123/v4/ba/e2/2a/bae22a5e-c878-da64-0ecc-4a3584a1a139/190295411411.jpg/200x200bb.png","genres":[{"genreId":"14","name":"Pop","url":"https://itunes.apple.com/us/genre/id14"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/no-6-collaborations-project/1464549183?app=music"},{"artistName":"The Black Keys","id":"1459700588","releaseDate":"2019-06-28","name":"\"Lets Rock\"","kind":"album","copyright":"℗ 2019 Nonesuch Records Inc. for the United States and WEA International Inc. for the world outside the United States.","artistId":"5893059","artistUrl":"https://music.apple.com/us/artist/the-black-keys/5893059?app=music","artworkUrl100":"https://is1-ssl.mzstatic.com/image/thumb/Music113/v4/5f/80/fd/5f80fd7c-2553-f24c-cd8a-4cd78efce869/075597924961.jpg/200x200bb.png","genres":[{"genreId":"20","name":"Alternative","url":"https://itunes.apple.com/us/genre/id20"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/lets-rock/1459700588?app=music"},{"artistName":"Clairo","id":"1465125166","releaseDate":"2019-08-02","name":"Immunity","kind":"album","copyright":"℗ 2019 Clairo under exclusive license to FADER Label","artistId":"1187613837","contentAdvisoryRating":"Explicit","artistUrl":"https://music.apple.com/us/artist/clairo/1187613837?app=music","artworkUrl100":"https://is3-ssl.mzstatic.com/image/thumb/Music113/v4/f2/47/f3/f247f339-3b74-fa86-0e55-6159bc734402/19UMGIM43559.rgb.jpg/200x200bb.png","genres":[{"genreId":"20","name":"Alternative","url":"https://itunes.apple.com/us/genre/id20"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/immunity/1465125166?app=music"},{"artistName":"Aaron Watson","id":"1458667753","releaseDate":"2019-06-21","name":"Red Bandana","kind":"album","copyright":"℗ 2019 Big Label Records","artistId":"39876943","artistUrl":"https://music.apple.com/us/artist/aaron-watson/39876943?app=music","artworkUrl100":"https://is1-ssl.mzstatic.com/image/thumb/Music123/v4/54/4b/a6/544ba62d-de9d-06ff-5e22-dbd97882d14b/190296902666.jpg/200x200bb.png","genres":[{"genreId":"6","name":"Country","url":"https://itunes.apple.com/us/genre/id6"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/red-bandana/1458667753?app=music"},{"artistName":"Lukas Nelson \u0026 Promise of the Real","id":"1460038337","releaseDate":"2019-06-14","name":"Turn Off The News (Build A Garden)","kind":"album","copyright":"℗ 2019 Fantasy Records, a division of Concord Music Group, Inc.","artistId":"395966992","contentAdvisoryRating":"Explicit","artistUrl":"https://music.apple.com/us/artist/lukas-nelson-promise-of-the-real/395966992?app=music","artworkUrl100":"https://is3-ssl.mzstatic.com/image/thumb/Music113/v4/e6/72/a1/e672a111-e5b9-e303-3447-a7b2222da2b3/00888072095229.rgb.jpg/200x200bb.png","genres":[{"genreId":"6","name":"Country","url":"https://itunes.apple.com/us/genre/id6"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/turn-off-the-news-build-a-garden/1460038337?app=music"},{"artistName":"Tyler Childers","id":"1462929670","releaseDate":"2019-08-02","name":"Country Squire","kind":"album","copyright":"℗ 2019 Hickman Holler Records, under exclusive license to RCA Records, a division of Sony Music Entertainment.","artistId":"473667472","artistUrl":"https://music.apple.com/us/artist/tyler-childers/473667472?app=music","artworkUrl100":"https://is1-ssl.mzstatic.com/image/thumb/Music113/v4/da/b8/04/dab804d9-4e04-68cb-bfbd-c65afa6c3e36/886447696750.jpg/200x200bb.png","genres":[{"genreId":"6","name":"Country","url":"https://itunes.apple.com/us/genre/id6"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/country-squire/1462929670?app=music"},{"artistName":"Slipknot","id":"1463706038","releaseDate":"2019-08-09","name":"We Are Not Your Kind","kind":"album","copyright":"℗ 2019 Roadrunner Records, Inc.","artistId":"6907568","contentAdvisoryRating":"Explicit","artistUrl":"https://music.apple.com/us/artist/slipknot/6907568?app=music","artworkUrl100":"https://is5-ssl.mzstatic.com/image/thumb/Music123/v4/2b/4d/97/2b4d97a1-d445-c0f9-6f95-f602392ec362/016861741006.jpg/200x200bb.png","genres":[{"genreId":"21","name":"Rock","url":"https://itunes.apple.com/us/genre/id21"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"},{"genreId":"1153","name":"Metal","url":"https://itunes.apple.com/us/genre/id1153"}],"url":"https://music.apple.com/us/album/we-are-not-your-kind/1463706038?app=music"},{"artistName":"Emeli Sandé","id":"1459085844","releaseDate":"2019-06-07","name":"REAL LIFE","kind":"album","copyright":"A Virgin EMI Records release; ℗ 2019 Virgin Records Ltd","artistId":"324008615","artistUrl":"https://music.apple.com/us/artist/emeli-sand%C3%A9/324008615?app=music","artworkUrl100":"https://is2-ssl.mzstatic.com/image/thumb/Music123/v4/f1/17/c4/f117c4cc-3fee-5b29-07fa-0c2e6e136455/00602577471148.rgb.jpg/200x200bb.png","genres":[{"genreId":"14","name":"Pop","url":"https://itunes.apple.com/us/genre/id14"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/real-life/1459085844?app=music"},{"artistName":"Tycho","id":"1461523692","releaseDate":"2019-07-12","name":"Weather","kind":"album","copyright":"℗ 2019 Mom+Pop/Ninja Tune","artistId":"119111355","artistUrl":"https://music.apple.com/us/artist/tycho/119111355?app=music","artworkUrl100":"https://is5-ssl.mzstatic.com/image/thumb/Music123/v4/8c/09/ab/8c09ab4b-b7ac-7270-6ba6-10c94446f464/Tycho_-_Weather_-_Digital_Cover_3000x3000_300DPI.jpg/200x200bb.png","genres":[{"genreId":"7","name":"Electronic","url":"https://itunes.apple.com/us/genre/id7"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/weather/1461523692?app=music"},{"artistName":"311","id":"1462034464","releaseDate":"2019-07-12","name":"Voyager","kind":"album","copyright":"℗ 2019 311 Band, LLC under exclusive license to BMG Rights Management (US) LLC","artistId":"1504658","artistUrl":"https://music.apple.com/us/artist/311/1504658?app=music","artworkUrl100":"https://is1-ssl.mzstatic.com/image/thumb/Music113/v4/fc/c9/6a/fcc96aef-9cf4-aebf-fc60-0b48e9528e8d/4050538484861.jpg/200x200bb.png","genres":[{"genreId":"21","name":"Rock","url":"https://itunes.apple.com/us/genre/id21"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/voyager/1462034464?app=music"},{"artistName":"Of Monsters and Men","id":"1461520104","releaseDate":"2019-07-26","name":"FEVER DREAM","kind":"album","copyright":"℗ 2019 SKRIMSL ehf, under exclusive license to Republic Records, a division of UMG Recordings, Inc.","artistId":"487906750","contentAdvisoryRating":"Explicit","artistUrl":"https://music.apple.com/us/artist/of-monsters-and-men/487906750?app=music","artworkUrl100":"https://is1-ssl.mzstatic.com/image/thumb/Music123/v4/0c/94/db/0c94db84-275e-9382-1c08-7411fc23de8a/19UMGIM38568.rgb.jpg/200x200bb.png","genres":[{"genreId":"20","name":"Alternative","url":"https://itunes.apple.com/us/genre/id20"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/fever-dream/1461520104?app=music"},{"artistName":"Silversun Pickups","id":"1457912926","releaseDate":"2019-06-07","name":"Widows Weeds","kind":"album","copyright":"℗ 2019 New Machine Recordings","artistId":"74752665","contentAdvisoryRating":"Explicit","artistUrl":"https://music.apple.com/us/artist/silversun-pickups/74752665?app=music","artworkUrl100":"https://is2-ssl.mzstatic.com/image/thumb/Music113/v4/69/54/69/695469ad-2d62-94ba-35fe-45eb426a289e/855380008883.png/200x200bb.png","genres":[{"genreId":"20","name":"Alternative","url":"https://itunes.apple.com/us/genre/id20"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/widows-weeds/1457912926?app=music"},{"artistName":"Bastille","id":"1458384183","releaseDate":"2019-06-14","name":"Doom Days","kind":"album","copyright":"A Virgin EMI Records release; ℗ 2019 Virgin Records Ltd","artistId":"420203509","contentAdvisoryRating":"Explicit","artistUrl":"https://music.apple.com/us/artist/bastille/420203509?app=music","artworkUrl100":"https://is3-ssl.mzstatic.com/image/thumb/Music113/v4/e5/a7/fa/e5a7fa61-7060-a250-6400-5ae814942b47/00602567792857.rgb.jpg/200x200bb.png","genres":[{"genreId":"20","name":"Alternative","url":"https://itunes.apple.com/us/genre/id20"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/doom-days/1458384183?app=music"},{"artistName":"Sabaton","id":"1459900085","releaseDate":"2019-06-19","name":"The Great War","kind":"album","copyright":"℗ 2019 Nuclear Blast","artistId":"184065032","contentAdvisoryRating":"Explicit","artistUrl":"https://music.apple.com/us/artist/sabaton/184065032?app=music","artworkUrl100":"https://is4-ssl.mzstatic.com/image/thumb/Music123/v4/fa/19/ad/fa19ad59-539e-97ad-8afd-232e365a2bf7/727361486563.jpg/200x200bb.png","genres":[{"genreId":"1153","name":"Metal","url":"https://itunes.apple.com/us/genre/id1153"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"},{"genreId":"21","name":"Rock","url":"https://itunes.apple.com/us/genre/id21"}],"url":"https://music.apple.com/us/album/the-great-war/1459900085?app=music"},{"artistName":"K.Flay","id":"1460755326","releaseDate":"2019-07-12","name":"Solutions","kind":"album","copyright":"℗ 2019 Interscope Records (Night Street Records)","artistId":"297760267","contentAdvisoryRating":"Explicit","artistUrl":"https://music.apple.com/us/artist/k-flay/297760267?app=music","artworkUrl100":"https://is3-ssl.mzstatic.com/image/thumb/Music113/v4/5f/56/4c/5f564cfd-e8e3-6694-4890-2be9d6d317f4/19UMGIM37942.rgb.jpg/200x200bb.png","genres":[{"genreId":"20","name":"Alternative","url":"https://itunes.apple.com/us/genre/id20"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"}],"url":"https://music.apple.com/us/album/solutions/1460755326?app=music"},{"artistName":"Calexico \u0026 Iron \u0026 Wine","id":"1454322293","releaseDate":"2019-06-14","name":"Years to Burn","kind":"album","copyright":"℗ 2019 Sub Pop Records","artistId":"14351970","artistUrl":"https://music.apple.com/WebObjects/MZStore.woa/wa/viewCollaboration?cc=us\u0026ids=14351970-3274302\u0026app=music","artworkUrl100":"https://is1-ssl.mzstatic.com/image/thumb/Music124/v4/61/b4/39/61b4393f-8664-eb77-8930-0f18ee0e22d8/CalexicoIronandWine_YearsToBurn_3000px.jpg/200x200bb.png","genres":[{"genreId":"20","name":"Alternative","url":"https://itunes.apple.com/us/genre/id20"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"},{"genreId":"21","name":"Rock","url":"https://itunes.apple.com/us/genre/id21"}],"url":"https://music.apple.com/us/album/years-to-burn/1454322293?app=music"},{"artistName":"Batushka","id":"1460415157","releaseDate":"2019-07-12","name":"Hospodi","kind":"album","copyright":"℗ 2019 Metal Blade Records","artistId":"1079391455","artistUrl":"https://music.apple.com/us/artist/batushka/1079391455?app=music","artworkUrl100":"https://is3-ssl.mzstatic.com/image/thumb/Music113/v4/de/a0/a1/dea0a152-17fe-1dfe-ee44-88c4542267bb/Batushka_-_Hospodi.jpg/200x200bb.png","genres":[{"genreId":"1153","name":"Metal","url":"https://itunes.apple.com/us/genre/id1153"},{"genreId":"34","name":"Music","url":"https://itunes.apple.com/us/genre/id34"},{"genreId":"21","name":"Rock","url":"https://itunes.apple.com/us/genre/id21"},{"genreId":"1149","name":"Death Metal/Black Metal","url":"https://itunes.apple.com/us/genre/id1149"}],"url":"https://music.apple.com/us/album/%D0%B3%D0%BE%D1%81%D0%BF%D0%BE%D0%B4%D0%B8/1460415157?app=music"}]}}"""
}